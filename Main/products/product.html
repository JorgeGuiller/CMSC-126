<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product</title>
    <link rel="stylesheet" href="/CSS/product.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

    <script defer src="/JS/nav.js"></script>
	<script type="module">
		import {PageRenderer} from '/JS/pageRenderer.js';
		import {Model} from '/JS/model.js';
		import {Authenticator} from "/JS/authenticator.js";
		import {db} from "/JS/connect.js";
		import {updateDoc, arrayUnion, arrayRemove, doc} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

		const authenticator = new Authenticator();
		const model = new Model();
 
		const authId = authenticator.getSignedInUserId();
    	const account = await model.getAccountById(authId);

		const renderer = new PageRenderer();

		const urlParams = new URLSearchParams(window.location.search);
		const id = urlParams.get('id');
        const productJson = sessionStorage.getItem(`${id}`);
		let product;

		if(productJson){
			product = JSON.parse(productJson);
			
		}else{
			const model = new Model();
			product = await model.getProductById(id);
		}
		renderer.renderPage(product);
		
		const wishButton=document.getElementById("addWishlist");
		wishButton.addEventListener("click", async ()=>{
			console.log("click");
			const toBeUpdated = doc(db, "Accounts", authId);
        
			await updateDoc(toBeUpdated, {
			wishlist: arrayUnion(id),
			});

		})
	</script>


</head>
<body>
    <nav class="navbar"></nav>

    <div class="card">
		<div id="product-img">
		  <img class="product-big-img">
		</div>
		<div class="description">
		  <h2 id="product-name"></h2>
		  <p id="product-info"></p>
		  <button id="goBuylo">Buy-lo</button>
		  <button id="addWishlist">Wishlist</button>
		</div>
	  </div>
	
	<script type="module">
	</script>

	<footer></footer>
</body>

</html> 