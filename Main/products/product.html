<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product</title>
    <link rel="stylesheet" href="/CSS/product.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

    <script defer src="/JS/nav.js"></script>
	<script type="module">
		import {PageRenderer} from '/JS/pageRenderer.js';
		import {Model} from '/JS/model.js';
		import {Authenticator} from "/JS/authenticator.js";
		import {db} from "/JS/connect.js";
		import {updateDoc, arrayUnion, arrayRemove, doc} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

		const authenticator = new Authenticator();
		const model = new Model();
 
		const authId = authenticator.getSignedInUserId();
    	const account = await model.getAccountById(authId);
	    


		const renderer = new PageRenderer();

		

		const urlParams = new URLSearchParams(window.location.search);
		const id = urlParams.get('id');
        const productJson = sessionStorage.getItem(`${id}`);
		let product;

		if(productJson){
			product = JSON.parse(productJson);
			
		}else{
			const model = new Model();
			product = await model.getProductById(id);
		}
		renderer.renderPage(product);


		
		const wishButton=document.getElementById("addWishlist");
		wishButton.addEventListener("click", async ()=>{
			console.log("click");
			const toBeUpdated = doc(db, "Accounts", authId);


        
			await updateDoc(toBeUpdated, {
			wishlist: arrayUnion(id),
			});

		})

	</script>


</head>
<body>
    <nav class="navbar"></nav>

    <container id="product">
		<div id="product-img">
		    <img class="product-big-img">
		</div>
		<div id="product-details">
			<p id="product-name"></p>
			<p id="product-info">
			</p>
		</div>
	</container>

	<!--
	<container id="owner">
		<div id="product-owner">
	    	<img class="user-avatar">
	    	<p class="user-name"></p>	
	    	<a class="user-contact" href="upcoming.html">Message</a>
	    	<a class="user-contact" href="upcoming.html">Follow</a>
	    </div>
	 </container>	 -->

	<div id="to-buylo">
		<a class="go-buylo" href="upcoming.html">Buy-lo</a>				<!-- Please apply css here -->
		<button type="button"	id="addWishlist">Add to wishlist</button> 	<!-- Please apply css here -->
	</div>
	
	<script type="module">
	</script>

	<footer></footer>
</body>

</html> 